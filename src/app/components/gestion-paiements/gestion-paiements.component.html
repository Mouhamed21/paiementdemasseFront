<p-toast position="top-center" key="tc"></p-toast>

<div class="card">
    <h5>Rechercher les paiements d'un bénéficiaire</h5>


    <p-toolbar styleClass="mb-5">
        <div class="col-12 md:col-6">
            <div class="p-inputgroup">
                <input type="text" pInputText placeholder="Taper le numéro de pension" [(ngModel)]="numPension"  cols="40" >
                <button type="button"  pButton pRipple label="Rechercher" (click)="paiementsByBeneficiaire(numPension)" ></button>
            </div>
        </div>
    </p-toolbar>
</div>

<div class="card">
    <p-table #dt [value]="paiements" [rows]="10" [paginator]="true" responsiveLayout="scroll"
              [rowHover]="true" dataKey="id"
             currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [showCurrentPageReport]="true">
        <ng-template pTemplate="caption">
            <div class="flex align-items-center justify-content-between">
                <h5 class="m-0">Résultats</h5>
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search..." />
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="idCaisse">Caisse <p-sortIcon field="code"></p-sortIcon></th>
                <th pSortableColumn="datePaiement">Date Paiement <p-sortIcon field="price"></p-sortIcon></th>
                <th pSortableColumn="beneficiaire">Beneficiaire <p-sortIcon field="category"></p-sortIcon></th>
                <th pSortableColumn="idUser">Payeur <p-sortIcon field="rating"></p-sortIcon></th>
                <th pSortableColumn="evenement">Evenement <p-sortIcon field="inventoryStatus"></p-sortIcon></th>
                <th pSortableColumn="montant">Montant (FCFA) <p-sortIcon field="inventoryStatus"></p-sortIcon></th>
                <th pSortableColumn="statut">Statut <p-sortIcon field="inventoryStatus"></p-sortIcon></th>
                <th>MODIFIER</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-paiement>

            <tr>
                <td style="width:14%; min-width:10rem;">
                    {{paiement.idCaisse.libelle}}
                </td>
                <td style="width:14%; min-width:10rem;">
                    {{paiement.datePaiement | date: 'dd/MM/yyyy' }}
                </td>
                <td style="width:14%; min-width:10rem;">
                    {{paiement.detailBeneficiaire.beneficiaire.nomPrenom}}
                </td>
                <td style="width:14%; min-width:10rem;">
                    {{paiement.idUser.prenom}} {{paiement.idUser.nom}}
                </td>
                <td style="width:14%; min-width:8rem;">
                    {{paiement.evenement.moisCampagne}}, {{paiement.evenement.anneeCampagne}}
                </td>
                <td style="width:14%; min-width:8rem;">
                    {{paiement.detailBeneficiaire.montant.toLocaleString('fr-FR')}}
                </td>
                <td style="width:14%; min-width:8rem;">
                    <span [ngStyle]="{backgroundColor:'var(--blue-200)'}"> {{paiement.detailBeneficiaire.statut.libelle}}</span>
                </td>
                <td>
                    <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2" (click)="editPaiement(paiement)"></button>
                </td>

            </tr>


        </ng-template>
        <ng-template pTemplate="summary">
            <div class="flex align-items-center justify-content-between">
                In total there are {{paiements ? paiements.length : 0 }} paiements.
            </div>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="paiementDialog" [style]="{width: '450px'}" header="paiement Details" [modal]="true" styleClass="p-fluid">
    <ng-template pTemplate="content">

        <div class="formgrid grid">
            <div class="field col">
                <label for="montant">Montant</label>
                <input disabled type="text" pInputText id="montant" [(ngModel)]="paiementChoisi.detailBeneficiaire.montant" required autofocus />
            </div>
            <div class="field col">
                <label for="benef">Bénéficiaire</label>
                <input disabled type="text" pInputText id="benef" [(ngModel)]="paiementChoisi.detailBeneficiaire.beneficiaire.nomPrenom" required autofocus />
            </div>
        </div>


        <div class="field">
            <label>Operation</label>
            <p-dropdown [options]="listeDesOperations" [(ngModel)]="suiviBeneficiaire.typeOperation" optionLabel="libelle" placeholder="Choisir une opération"></p-dropdown>
        </div>

        <div class="field">
            <label for="description">MOTIF</label>
            <textarea id="description" pInputTextarea [(ngModel)]="suiviBeneficiaire.motif" required rows="3" cols="20"></textarea>
        </div>

    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="postSuiviBeneficiaire()"></button>
    </ng-template>
</p-dialog>
